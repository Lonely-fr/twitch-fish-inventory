<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†—ã–±–Ω—ã–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .fish-card {
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 20px;
            height: 100%;
        }
        .fish-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .card-img-top {
            height: 200px;
            object-fit: contain;
            background-color: #f8f9fa;
            padding: 10px;
        }
        .rarity-common { border-left: 5px solid #6c757d; }
        .rarity-uncommon { border-left: 5px solid #28a745; }
        .rarity-rare { border-left: 5px solid #17a2b8; }
        .rarity-epic { border-left: 5px solid #6f42c1; }
        .rarity-legendary { border-left: 5px solid #fd7e14; }
        .rarity-immortal { border-left: 5px solid #dc3545; }
        .rarity-mythical { border-left: 5px solid #e83e8c; }
        .rarity-arcane { border-left: 5px solid #20c997; }
        .rarity-ultimate { border-left: 5px solid #ffc107; }
        .badge {
            font-size: 0.9em;
            margin-right: 5px;
        }
        #loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .container {
            transition: opacity 0.3s;
        }
        .container.hidden {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="py-4">
            <h1 class="text-center">üêü –†—ã–±–Ω—ã–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h1>
            <div class="row g-2">
                <div class="col-md-6">
                    <input type="text" id="username" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫">
                </div>
                <div class="col-md-4">
                    <select id="rarityFilter" class="form-select">
                        <option value="all">–í—Å–µ —Ä–µ–¥–∫–æ—Å—Ç–∏</option>
                        <option value="common">Common</option>
                        <option value="uncommon">Uncommon</option>
                        <option value="rare">Rare</option>
                        <option value="epic">Epic</option>
                        <option value="legendary">Legendary</option>
                        <option value="immortal">Immortal</option>
                        <option value="mythical">Mythical</option>
                        <option value="arcane">Arcane</option>
                        <option value="ultimate">Ultimate</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button id="loadBtn" class="btn btn-primary w-100">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
            </div>
        </header>

        <div id="loading" class="d-none">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
        </div>

        <div id="inventory" class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4"></div>

        <div class="d-flex justify-content-between mt-4">
            <button id="prevPage" class="btn btn-outline-primary" disabled>–ù–∞–∑–∞–¥</button>
            <span id="pageInfo" class="text-muted">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1</span>
            <button id="nextPage" class="btn btn-outline-primary" disabled>–í–ø–µ—Ä–µ–¥</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
            const config = {
                itemsPerPage: 12,
                apiBaseUrl: "http://localhost:8000/api"
            };

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            const state = {
                currentPage: 1,
                allFish: [],
                filteredFish: []
            };

            // –ö—ç—à —ç–ª–µ–º–µ–Ω—Ç–æ–≤ DOM
            const dom = {
                inventory: document.getElementById("inventory"),
                username: document.getElementById("username"),
                rarityFilter: document.getElementById("rarityFilter"),
                loadBtn: document.getElementById("loadBtn"),
                prevPage: document.getElementById("prevPage"),
                nextPage: document.getElementById("nextPage"),
                pageInfo: document.getElementById("pageInfo"),
                loading: document.getElementById("loading"),
                container: document.querySelector(".container")
            };

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
            function initEvents() {
                dom.loadBtn.addEventListener("click", loadInventory);
                dom.rarityFilter.addEventListener("change", filterInventory);
                dom.prevPage.addEventListener("click", () => changePage(-1));
                dom.nextPage.addEventListener("click", () => changePage(1));
            }

            // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            async function loadInventory() {
                const username = dom.username.value.trim();
                if (!username) return alert("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫!");

                toggleLoading(true);
                
                try {
                    const [inventory, fishes] = await Promise.all([
                        fetchData(`${config.apiBaseUrl}/inventory/${username}`),
                        fetchData(`${config.apiBaseUrl}/fishes`)
                    ]);
                    
                    state.allFish = (inventory.fishes || []).map(fishId => 
                        fishes.fishes.find(f => f.id === fishId) || 
                        { id: fishId, name: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä—ã–±–∞", rarity: "common" }
                    );
                    
                    filterInventory();
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞:", error);
                    alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö");
                } finally {
                    toggleLoading(false);
                }
            }

            function filterInventory() {
                const rarity = dom.rarityFilter.value;
                state.filteredFish = rarity === "all" 
                    ? [...state.allFish] 
                    : state.allFish.filter(fish => fish.rarity === rarity);
                
                state.currentPage = 1;
                renderInventory();
            }

            function renderInventory() {
                const startIdx = (state.currentPage - 1) * config.itemsPerPage;
                const pageFish = state.filteredFish.slice(startIdx, startIdx + config.itemsPerPage);
                
                dom.inventory.innerHTML = pageFish.length 
                    ? pageFish.map(createFishCard).join("")
                    : '<div class="col-12 text-center py-5"><h4>–†—ã–± –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h4></div>';
                
                updatePagination();
            }

            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            function createFishCard(fish) {
                return `
                    <div class="col">
                        <div class="card fish-card rarity-${fish.rarity}">
                            <img src="https://via.placeholder.com/300x200?text=${encodeURIComponent(fish.name)}" 
                                class="card-img-top" alt="${fish.name}">
                            <div class="card-body">
                                <h5 class="card-title">${fish.name}</h5>
                                <div>
                                    <span class="badge ${getRarityClass(fish.rarity)}">
                                        ${getRarityName(fish.rarity)}
                                    </span>
                                    ${fish.price ? `<span class="badge bg-primary">${fish.price} LC</span>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function updatePagination() {
                const totalPages = Math.ceil(state.filteredFish.length / config.itemsPerPage);
                dom.pageInfo.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${state.currentPage} –∏–∑ ${totalPages}`;
                dom.prevPage.disabled = state.currentPage <= 1;
                dom.nextPage.disabled = state.currentPage >= totalPages;
            }

            function changePage(delta) {
                const newPage = state.currentPage + delta;
                const totalPages = Math.ceil(state.filteredFish.length / config.itemsPerPage);
                
                if (newPage > 0 && newPage <= totalPages) {
                    state.currentPage = newPage;
                    renderInventory();
                }
            }

            function toggleLoading(show) {
                dom.loading.classList.toggle("d-none", !show);
                dom.container.classList.toggle("hidden", show);
            }

            async function fetchData(url) {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            }

            // –£—Ç–∏–ª–∏—Ç—ã
            const RARITY_MAP = {
                common: { class: "bg-secondary", name: "–û–±—ã—á–Ω–∞—è" },
                uncommon: { class: "bg-success", name: "–ù–µ–æ–±—ã—á–Ω–∞—è" },
                rare: { class: "bg-info", name: "–†–µ–¥–∫–∞—è" },
                epic: { class: "bg-primary", name: "–≠–ø–∏—á–µ—Å–∫–∞—è" },
                legendary: { class: "bg-warning text-dark", name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è" },
                immortal: { class: "bg-danger", name: "–ë–µ—Å—Å–º–µ—Ä—Ç–Ω–∞—è" },
                mythical: { class: "bg-pink", name: "–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è" },
                arcane: { class: "bg-teal", name: "–¢–∞–π–Ω–∞—è" },
                ultimate: { class: "bg-gold", name: "–£–Ω–∏–∫–∞–ª—å–Ω–∞—è" }
            };

            function getRarityClass(rarity) {
                return RARITY_MAP[rarity]?.class || "bg-secondary";
            }

            function getRarityName(rarity) {
                return RARITY_MAP[rarity]?.name || rarity;
            }

            // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            initEvents();
        });
    </script>
</body>
</html>