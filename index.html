<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†—ã–±–Ω—ã–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .fish-card {
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 20px;
            height: 100%;
        }
        .fish-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .card-img-top {
            height: 200px;
            object-fit: contain;
            background-color: #f8f9fa;
            padding: 10px;
        }
        .rarity-common { border-left: 5px solid #6c757d; }
        .rarity-uncommon { border-left: 5px solid #28a745; }
        .rarity-rare { border-left: 5px solid #17a2b8; }
        .rarity-epic { border-left: 5px solid #6f42c1; }
        .rarity-legendary { border-left: 5px solid #fd7e14; }
        .rarity-immortal { border-left: 5px solid #dc3545; }
        .rarity-mythical { border-left: 5px solid #e83e8c; }
        .rarity-arcane { border-left: 5px solid #20c997; }
        .rarity-ultimate { border-left: 5px solid #ffc107; }
        .badge {
            font-size: 0.9em;
            margin-right: 5px;
        }
        #loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="py-4">
            <h1 class="text-center">üêü –†—ã–±–Ω—ã–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h1>
            <div class="row">
                <div class="col-md-6">
                    <input type="text" id="username" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫">
                </div>
                <div class="col-md-4">
                    <select id="rarityFilter" class="form-select">
                        <option value="all">–í—Å–µ —Ä–µ–¥–∫–æ—Å—Ç–∏</option>
                        <option value="common">Common</option>
                        <option value="uncommon">Uncommon</option>
                        <option value="rare">Rare</option>
                        <option value="epic">Epic</option>
                        <option value="legendary">Legendary</option>
                        <option value="immortal">Immortal</option>
                        <option value="mythical">Mythical</option>
                        <option value="arcane">Arcane</option>
                        <option value="ultimate">Ultimate</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button id="loadBtn" class="btn btn-primary w-100">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
            </div>
        </header>

        <div id="loading" class="d-none">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
        </div>

        <div id="inventory" class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4"></div>

        <div class="d-flex justify-content-between mt-4">
            <button id="prevPage" class="btn btn-outline-primary" disabled>–ù–∞–∑–∞–¥</button>
            <span id="pageInfo">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1</span>
            <button id="nextPage" class="btn btn-outline-primary" disabled>–í–ø–µ—Ä–µ–¥</button>
        </div>
    </div>

    <script>
        let currentPage = 1;
        let itemsPerPage = 12;
        let allFish = [];
        let filteredFish = [];

        document.getElementById('loadBtn').addEventListener('click', loadInventory);
        document.getElementById('rarityFilter').addEventListener('change', filterInventory);
        document.getElementById('prevPage').addEventListener('click', () => changePage(-1));
        document.getElementById('nextPage').addEventListener('click', () => changePage(1));

        async function loadInventory() {
            const username = document.getElementById('username').value.trim();
            if (!username) {
                alert('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫!');
                return;
            }

            showLoading(true);
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const inventoryResponse = await fetch(`http://localhost:8000/api/inventory/${username}`);
                const inventoryData = await inventoryResponse.json();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ä—ã–±—ã
                const fishResponse = await fetch('http://localhost:8000/api/fishes');
                const fishData = await fishResponse.json();
                
                // –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º —Ä—ã–±—ã –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                allFish = inventoryData.fishes.map(fishId => {
                    return fishData.fishes.find(f => f.id === fishId) || {id: fishId, name: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä—ã–±–∞", rarity: "common"};
                });
                
                filterInventory();
                showLoading(false);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è');
                showLoading(false);
            }
        }

        function filterInventory() {
            const rarity = document.getElementById('rarityFilter').value;
            
            if (rarity === 'all') {
                filteredFish = [...allFish];
            } else {
                filteredFish = allFish.filter(fish => fish.rarity === rarity);
            }
            
            currentPage = 1;
            renderInventory();
        }

        function renderInventory() {
            const startIdx = (currentPage - 1) * itemsPerPage;
            const endIdx = startIdx + itemsPerPage;
            const pageFish = filteredFish.slice(startIdx, endIdx);
            
            const inventoryEl = document.getElementById('inventory');
            inventoryEl.innerHTML = '';
            
            if (pageFish.length === 0) {
                inventoryEl.innerHTML = '<div class="col-12 text-center py-5"><h4>–†—ã–± –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h4></div>';
                document.getElementById('prevPage').disabled = true;
                document.getElementById('nextPage').disabled = true;
                document.getElementById('pageInfo').textContent = '–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1';
                return;
            }
            
            pageFish.forEach(fish => {
                const rarityClass = `rarity-${fish.rarity}`;
                const priceBadge = fish.price ? `<span class="badge bg-primary">${fish.price} LC</span>` : '';
                
                inventoryEl.innerHTML += `
                    <div class="col">
                        <div class="card fish-card ${rarityClass}">
                            <img src="https://via.placeholder.com/300x200?text=${encodeURIComponent(fish.name)}" class="card-img-top" alt="${fish.name}">
                            <div class="card-body">
                                <h5 class="card-title">${fish.name}</h5>
                                <div>
                                    <span class="badge ${getRarityBadgeClass(fish.rarity)}">${getRarityName(fish.rarity)}</span>
                                    ${priceBadge}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
            const totalPages = Math.ceil(filteredFish.length / itemsPerPage);
            document.getElementById('pageInfo').textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage} –∏–∑ ${totalPages}`;
            document.getElementById('prevPage').disabled = currentPage <= 1;
            document.getElementById('nextPage').disabled = currentPage >= totalPages;
        }

        function changePage(delta) {
            const newPage = currentPage + delta;
            const totalPages = Math.ceil(filteredFish.length / itemsPerPage);
            
            if (newPage > 0 && newPage <= totalPages) {
                currentPage = newPage;
                renderInventory();
            }
        }

        function getRarityBadgeClass(rarity) {
            const classes = {
                'common': 'bg-secondary',
                'uncommon': 'bg-success',
                'rare': 'bg-info',
                'epic': 'bg-primary',
                'legendary': 'bg-warning text-dark',
                'immortal': 'bg-danger',
                'mythical': 'bg-pink',
                'arcane': 'bg-teal',
                'ultimate': 'bg-gold'
            };
            return classes[rarity] || 'bg-secondary';
        }

        function getRarityName(rarity) {
            const names = {
                'common': '–û–±—ã—á–Ω–∞—è',
                'uncommon': '–ù–µ–æ–±—ã—á–Ω–∞—è',
                'rare': '–†–µ–¥–∫–∞—è',
                'epic': '–≠–ø–∏—á–µ—Å–∫–∞—è',
                'legendary': '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è',
                'immortal': '–ë–µ—Å—Å–º–µ—Ä—Ç–Ω–∞—è',
                'mythical': '–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è',
                'arcane': '–¢–∞–π–Ω–∞—è',
                'ultimate': '–£–Ω–∏–∫–∞–ª—å–Ω–∞—è'
            };
            return names[rarity] || rarity;
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('d-none', !show);
            document.querySelector('.container').classList.toggle('d-none', show);
        }
    </script>
</body>
</html>